<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>IIMOC Problem - Sample Greeting</title>
<meta name="description" content="Solve the sample greeting problem." />
<style>
  body {
    background: #181818;
    color: #f0f0f0;
    font-family: Consolas, 'Courier New', monospace;
    margin: 0;
    padding: 0;
  }
  header {
    width: 100%;
    background: #181818;
    border-bottom: 1px solid #333;
  }
  .nav {
    display: flex;
    align-items: center;
    justify-content: space-between;
    max-width: 740px;
    margin: 0 auto;
    padding: 16px 20px 8px 20px;
  }
  .nav-links {
    display: flex;
    gap: 18px;
  }
  .nav-link, .btn {
    background: #282828;
    color: #f0f0f0;
    border: 1px solid #444;
    border-radius: 4px;
    padding: 10px 20px;
    font-family: inherit;
    font-size: 1.09rem;
    cursor: pointer;
    text-decoration: none;
    font-weight: 600;
    letter-spacing: 1px;
    transition: background .13s;
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }
  .btn-lg {
    font-size: 1.13rem;
    padding: 14px 26px;
    margin-top: 14px;
  }
  .nav-link:hover, .btn:hover {
    background: #333;
  }
  .nav-link.active {
    background: #333;
    cursor: default;
  }
  .brand-title {
    font-size: 1.5rem;
    color: #fafafa;
    letter-spacing: 2px;
    font-family: inherit;
    display: flex;
    align-items: center;
    gap: 7px;
    cursor: pointer;
    text-decoration: none;
  }
  .brand-title svg {
    vertical-align: middle;
    height: 38px;
    width: 38px;
    color: #b89bfa;
    stroke-width: 2.2;
    flex-shrink: 0;
  }
  #scrambleText {
    color: #fff;
    letter-spacing: 0.02em;
    font-weight: bold;
    font-size: 1.2em;
    display: flex;
    align-items: center;
  }
  .brand-title .scramble-char {
    display: inline-block;
    min-width: 1ch;
    transition: color 0.17s;
    color: inherit;
    font-family: inherit;
  }
  main {
    width: 100%;
  }
  .container {
    max-width: 740px;
    margin: 56px auto 40px auto;
    padding: 38px 32px 32px 32px;
    background: #222;
    border-radius: 8px;
    border: 1px solid #444;
    box-sizing: border-box;
  }
  h1, h2, h3 {
    color: #fafafa;
    font-weight: normal;
    letter-spacing: 2px;
  }
  h1 {
    margin-top: 0;
    text-align: center;
    font-size: 2.1rem;
    margin-bottom: 18px;
  }
  .problem-text {
    background: #1b1b1e;
    border: 1px solid #333;
    border-radius: 6px;
    padding: 22px 24px;
    margin-bottom: 28px;
    line-height: 1.6;
    color: #e0e0e0;
    font-size: 1.04rem;
  }
  pre {
    background: #111;
    border: 1px solid #333;
    border-radius: 6px;
    padding: 18px;
    overflow-x: auto;
    font-size: 1rem;
  }
  .code-form {
    display: flex;
    flex-direction: column;
    gap: 14px;
  }
  label {
    font-size: 1.02rem;
    letter-spacing: 1px;
    color: #d6d6d6;
  }
  textarea {
    min-height: 220px;
    background: #111;
    color: #fafafa;
    border: 1px solid #444;
    border-radius: 6px;
    padding: 16px;
    font-family: Consolas, 'Courier New', monospace;
    font-size: 1rem;
    resize: vertical;
  }
  textarea:focus {
    outline: 2px solid #735ac4;
    outline-offset: 0;
  }
  .status-panel {
    margin-top: 28px;
    background: #1a1a1d;
    border: 1px solid #34343a;
    border-radius: 6px;
    padding: 18px 20px;
  }
  .status-text {
    color: #c0c0c0;
    font-size: 1.02rem;
    margin: 0 0 12px 0;
  }
  .cases-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 12px;
  }
  .cases-table th, .cases-table td {
    border: 1px solid #34343a;
    padding: 10px 12px;
    text-align: left;
    font-size: 0.98rem;
  }
  .cases-table th {
    background: #26262b;
    color: #f5f5f5;
    letter-spacing: 1px;
  }
  .cases-table tr:nth-child(even) {
    background: #202024;
  }
  .case-status-ok {
    color: #8adf8a;
    font-weight: 600;
  }
  .case-status-fail {
    color: #ff8a80;
    font-weight: 600;
  }
  .hidden {
    display: none;
  }
  @media (max-width: 900px) {
    .container, .nav {
      max-width: 98vw;
      padding-left: 5vw;
      padding-right: 5vw;
    }
    .cases-table {
      display: block;
      overflow-x: auto;
    }
  }
</style>
</head>
<body>
<header>
  <nav class="nav">
    <a href="/index.html" class="brand-title" id="brandTitle">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
        <path d="M18 4H6l7 8-7 8h12" />
      </svg>
      <span id="scrambleText">
        <span class="scramble-char">I</span>
        <span class="scramble-char">I</span>
        <span class="scramble-char">M</span>
        <span class="scramble-char">O</span>
        <span class="scramble-char">C</span>
      </span>
    </a>
    <div class="nav-links">
      <a class="nav-link" href="/sponsor.html">Sponsors</a>
      <a class="nav-link" href="/team.html">Our Team</a>
      <a class="nav-link" href="/contact.html">Contact</a>
      <span class="nav-link active">Problem</span>
    </div>
  </nav>
</header>
<main>
  <section class="container">
    <h1>Sample Problem (Credit: AtCoder Heuristic Contest 001)</h1>
    <div class="problem-text">
        <h2>Problem Statement</h2>
        <p>AtCoder has decided to place web advertisements of <b>n</b> companies on the top page.<br>
        The space for placing advertisements is a square of size 10000 x 10000.<br>
        The space for each company must be an axis-parallel rectangle with positive area, and the coordinates of the vertices must be integer values.<br>
        Different rectangles may touch on their sides, but they must not overlap. In other words, the common area must not have positive area.<br>
        It is allowed to leave some free space that does not belong to any ad.</p>
        <p>President Takahashi asked each company for their desired location and area. Company <b>i</b> wants an ad space with area <b>r<sub>i</sub></b> including point <b>(x<sub>i</sub>+0.5, y<sub>i</sub>+0.5)</b>.<br>
        The satisfaction level <b>p<sub>i</sub></b> of company <b>i</b> is determined as follows.</p>
        <ul>
          <li>If the ad space for company <b>i</b> does not contain the point <b>(x<sub>i</sub>+0.5, y<sub>i</sub>+0.5)</b>, then <b>p<sub>i</sub> = 0</b>.</li>
          <li>If the ad space for company <b>i</b> contains the point <b>(x<sub>i</sub>+0.5, y<sub>i</sub>+0.5)</b> and the area is <b>s<sub>i</sub></b>, then <b>p<sub>i</sub> = 1 - (1 - min(r<sub>i</sub>,s<sub>i</sub>) / max(r<sub>i</sub>, s<sub>i</sub>))<sup>2</sup></b>.</li>
        </ul>
        <p>Your task is to determine the placement of the ads so that the sum of the satisfaction levels is maximized.<br>
        You will get a score of <b>10<sup>9</sup> × ∑p<sub>i</sub> / n</b> rounded to the nearest integer.</p>
        <h2>Input</h2>
        <pre>
        n
        x_0 y_0 r_0
        ...
        x_{n-1} y_{n-1} r_{n-1}
        </pre>
        <ul>
          <li>50 ≤ n ≤ 200</li>
          <li>x<sub>i</sub> and y<sub>i</sub> are integers satisfying 0 ≤ x<sub>i</sub> ≤ 9999 and 0 ≤ y<sub>i</sub> ≤ 9999. For any i ≠ j, (x<sub>i</sub>,y<sub>i</sub>) ≠ (x<sub>j</sub>,y<sub>j</sub>) holds.</li>
          <li>r<sub>i</sub> is an integer at least one and satisfies ∑r<sub>i</sub> = 10000 × 10000.</li>
        </ul>
        <h2>Output</h2>
        <p>Let (a<sub>i</sub>, b<sub>i</sub>) and (c<sub>i</sub>, d<sub>i</sub>) (0 ≤ a<sub>i</sub> < c<sub>i</sub> ≤ 10000, 0 ≤ b<sub>i</sub> < d<sub>i</sub> ≤ 10000) be the coordinates of the two diagonal vertices of the rectangle representing the ad space for company <b>i</b>.<br>
        Output to standard output in the following format.</p>
        <pre>
        a_0 b_0 c_0 d_0
        ...
        a_{n-1} b_{n-1} c_{n-1} d_{n-1}
        </pre>
        <h2>Input Generation</h2>
        <p>Let <code>rand()</code> be a function that generates a uniformly random double-precision floating point number at least zero and less than one.</p>
        <h3>Generation of n</h3>
        <p>The number of companies n is generated by rounding 50 × 4<sup>rand()</sup> to the nearest integer value.</p>
        <h3>Generation of x<sub>i</sub> and y<sub>i</sub></h3>
        <p>The list of desired locations (x<sub>1</sub>,y<sub>i</sub>),..., (x<sub>n</sub>,y<sub>n</sub>) is generated by randomly sampling n distinct coordinates from {(x, y) | x∈{0,1,...,9999}, y∈{0,1,...,9999}}.</p>
        <h3>Generation of r<sub>i</sub></h3>
        <p>Let q<sub>1</sub>,...,q<sub>n-1</sub> be a sorted list of n-1 distinct integers randomly sampled from {1,2,...,99999999}.
        Let q<sub>0</sub>=0 and q<sub>n</sub>=100000000.<br>
        Then r<sub>i</sub>=q<sub>i+1</sub>−q<sub>i</sub>.</p>
        <h2>Number of test cases</h2>
        <ul>
          <li>Provisional test: 50</li>
          <li>System test: 1000. We will publish seeds.txt (md5=8fc1ce3f4beabac6abc1bdb4206d7f7e) after the contest is over.</li>
        </ul>
        <p>The score of a submission is the total scores for each test case.<br>
        In the provisional test, if your submission produces illegal output or exceeds the time limit for some test cases, the submission itself will be judged as WA or TLE, and the score of the submission will be zero.<br>
        In the system test, if your submission produces illegal output or exceeds the time limit for some test cases, only the score for those test cases will be zero.</p>
        <h2>Tools</h2>
        <p>You can download an input generator and visualizer <a href="https://img.atcoder.jp/ahc001/ded8fd3366b4ff0b0d7d053f553cdb84.zip">here</a>.<br>
        To use them, you need a compilation environment of <a href="https://www.rust-lang.org/ja">Rust language</a>.</p>
        <h2>Sample</h2>
        <h3>Input</h3>
        <pre>50
1909 360 6468907
5810 7091 4661329
5407 422 2010076
5767 3140 681477
6659 3234 920591
4206 1620 2487369
7853 9492 440133
7875 432 586159
9048 5059 1805425
7292 9070 509242
7633 2496 1558444
421 4835 1808752
7164 4109 35081
5356 2271 78438
5261 577 971398
3546 5225 1871979
4667 3386 28796
5596 7896 3310195
2518 9813 1739130
9002 3913 334620
8574 8947 1107057
3118 1773 669849
7140 4388 2098247
8544 8196 1742491
8577 4337 4435283
3155 9168 976005
7823 4404 945830
9451 110 569854
7031 1389 787729
1841 2337 942236
76 8364 710110
3543 3931 3840994
3927 8828 2920828
5671 3305 1526349
5542 4587 6285390
4030 7732 3962404
8575 8200 3662259
1139 3739 254000
50 7415 647735
934 4056 1800657
8801 7178 1218595
4499 6207 660560
3096 3375 2695827
5252 3281 1046149
2247 1446 7148429
3347 8501 7546190
5791 8600 3909497
8033 8992 3365971
2297 9254 23830
4312 6176 192104</pre>
<h3>Output</h3>
<pre>0 0 4473 1446
4634 5915 6987 7896
4473 0 7875 577
5260 2633 6274 3305
6274 2722 7172 3747
3174 1446 5238 2651
7522 9161 8185 9824
7875 0 8454 1012
8376 4388 9720 5731
6890 8668 7522 9473
7172 1815 8315 3178
0 4072 1185 5598
7071 4016 7258 4203
5238 2124 5504 2418
5260 577 5958 1274
2862 4541 4230 5909
4582 3302 4752 3471
3348 7896 8049 8600
1351 9255 3685 10000
8713 3624 9291 4202
8185 8373 9149 9521
2480 1446 3174 2411
6105 4203 7823 5424
8049 5731 8575 8373
7823 3178 8713 4388
2410 8600 3900 9255
7823 4388 8376 5731
8969 0 9933 591
6581 940 7481 1815
1356 1852 2327 2822
0 7805 635 8923
1286 3376 4582 4541
3900 8600 5791 10000
4752 3305 6274 4203
4582 4203 6105 5915
2287 6208 4634 7896
8575 7179 10000 8373
849 3449 1286 4030
0 6812 652 7805
0 4030 1286 4072
8575 6182 9797 7179
4313 5915 4634 6208
2327 2651 4582 3376
4752 2651 5260 3305
0 1446 2480 1852
635 7896 3348 8600
5791 8600 6890 10000
7522 8600 8185 9161
2188 9146 2406 9255
3671 5909 4313 6208
    </div>
    <form class="code-form" id="codeForm">
      <label for="codeInput">Submit your Python solution</label>
      <textarea id="codeInput" name="code" placeholder="print('hello')" required></textarea>
      <button type="submit" class="btn btn-lg" id="submitBtn">Submit Solution</button>
    </form>
    <div class="status-panel hidden" id="statusPanel">
      <p class="status-text" id="statusText">Waiting for submission...</p>
      <div id="casesContainer"></div>
    </div>
  </section>
</main>
<script>
  const URL = "https://diphycercal-aurore-introrsely.ngrok-free.dev";
  const form = document.getElementById('codeForm');
  const codeInput = document.getElementById('codeInput');
  const submitBtn = document.getElementById('submitBtn');
  const statusPanel = document.getElementById('statusPanel');
  const statusText = document.getElementById('statusText');
  const casesContainer = document.getElementById('casesContainer');

  async function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  function formatTime(ns) {
    if (typeof ns !== 'number' || !Number.isFinite(ns)) {
      return '—';
    }
    return (ns / 1e6).toFixed(2) + ' ms';
  }

  function formatMemory(bytes) {
    if (typeof bytes !== 'number' || !Number.isFinite(bytes)) {
      return '—';
    }
    return (bytes / 1024).toFixed(0) + ' KB';
  }

  function renderCases(cases) {
    if (!Array.isArray(cases) || cases.length === 0) {
      casesContainer.innerHTML = '<p class="status-text">No cases available.</p>';
      return;
    }

    const rows = cases.map((test, index) => {
      const statusClass = test.ok ? 'case-status-ok' : 'case-status-fail';
      const message = (test.msg || '').replace(/\n/g, '<br />');
      return `
        <tr>
          <td>Case ${index + 1}</td>
          <td class="${statusClass}">${test.status || (test.ok ? 'Accepted' : 'Failed')}</td>
          <td>${formatTime(test.time)}</td>
          <td>${formatMemory(test.memory)}</td>
          <td>${message}</td>
        </tr>
      `;
    }).join('');

    casesContainer.innerHTML = `
      <table class="cases-table">
        <thead>
          <tr>
            <th>Case</th>
            <th>Status</th>
            <th>Time</th>
            <th>Memory</th>
            <th>Message</th>
          </tr>
        </thead>
        <tbody>
          ${rows}
        </tbody>
      </table>
    `;

    for (const test of cases) {
      let msg = (test.msg || '');
      const idx = cases.indexOf(test);
      const row = casesContainer.querySelector(`tbody tr:nth-child(${idx + 1})`);
      if (idx === 0) {
        // initialize accumulators and remove any previous total display
        casesContainer._scoreTotal = 0;
        casesContainer._anyFail = false;
        const prev = document.getElementById('totalScoreBadge');
        if (prev) prev.remove();
      }

      if (!test.ok) {
        casesContainer._anyFail = true;
      }

      const match = msg.match(/-?\d[\d,]*(?:\.\d+)?/);
      if (match) {
        const value = Number(match[0].replace(/,/g, ''));
        test.extractedNumber = value;
        casesContainer._scoreTotal = (casesContainer._scoreTotal || 0) + value;

        if (row) {
          const cell = row.cells[4];
          if (cell) {
        const badge = document.createElement('span');
        badge.style.marginLeft = '10px';
        badge.style.color = '#9ee6ff';
        badge.style.fontWeight = '700';
        badge.textContent = `Extracted: ${value}`;
        cell.appendChild(badge);
          }
        }
      }
      
      // After processing the last case, compute and display the total score.
      if (idx === cases.length - 1) {
        const finalScore = casesContainer._anyFail ? 0 : (casesContainer._scoreTotal || 0);
        const totalEl = document.createElement('div');
        totalEl.id = 'totalScoreBadge';
        totalEl.style.marginTop = '12px';
        totalEl.style.padding = '10px 14px';
        totalEl.style.background = '#0b2a2f';
        totalEl.style.color = '#9ee6ff';
        totalEl.style.fontWeight = '700';
        totalEl.style.border = '1px solid #07494f';
        totalEl.style.display = 'inline-block';
        totalEl.textContent = `Total Score: ${finalScore}`;

        const table = casesContainer.querySelector('.cases-table') || casesContainer.querySelector('table');

        statusPanel.prepend(totalEl);

      }
    }
  }

  async function pollForResult(sid) {
    let attempt = 0;
    while (true) {
      attempt += 1;
      try {
        const response = await fetch(`${URL}/result/${encodeURIComponent(sid)}`, {
          headers: {
            'ngrok-skip-browser-warning': 'true'
          }
        });
        if (!response.ok) {
          throw new Error('Result request failed with status ' + response.status);
        }
        const payload = await response.json();
        if (payload && payload.status === 'done') {
          return payload;
        }
        statusText.textContent = `In queue (attempt ${attempt})...`;
      } catch (error) {
        console.error(error);
        statusText.textContent = 'Judging...';
      }
      await sleep(1000);
    }
  }

  form.addEventListener('submit', async (event) => {
    event.preventDefault();

    const code = codeInput.value.trim();
    if (!code) {
      statusPanel.classList.remove('hidden');
      statusText.textContent = 'Please enter some code before submitting.';
      return;
    }

    submitBtn.disabled = true;
    submitBtn.textContent = 'Submitting...';
    statusPanel.classList.remove('hidden');
    statusText.textContent = 'Submitting your solution...';
    casesContainer.innerHTML = '';

    try {
      const payload = { pid: 'ahc001', lang: 'python', code };

      async function sendSubmission(body, contentType) {
        const fetchOptions = {
          method: 'POST',
          body
        };

        if (contentType) {
          fetchOptions.headers = {
            'Content-Type': contentType,
            'ngrok-skip-browser-warning': 'true'
          };
        } else {
          fetchOptions.headers = {
            'ngrok-skip-browser-warning': 'true'
          };
        }

        const response = await fetch(`${URL}/submit`, fetchOptions);

        if (!response.ok) {
          throw new Error('Submission failed with status ' + response.status);
        }

        return response.json();
      }

      let submission;

      try {
        submission = await sendSubmission(JSON.stringify(payload), 'application/json');
      } catch (networkError) {
        if (networkError instanceof TypeError) {
          console.warn('Falling back to plain text submission to avoid CORS preflight.', networkError);
          submission = await sendSubmission(JSON.stringify(payload), 'text/plain;charset=UTF-8');
        } else {
          throw networkError;
        }
      }

      if (!submission || typeof submission !== 'object') {
        throw new Error('Judge returned an invalid response.');
      }

      const { sid } = submission;
      if (!sid) {
        throw new Error('Judge did not return a submission id.');
      }

      statusText.textContent = 'Submission received. Fetching results...';
      const result = await pollForResult(sid);
      statusText.textContent = '';
      renderCases(result.cases);
    } catch (error) {
      console.error(error);
      statusText.textContent = 'An error occurred: ' + (error.message || 'Unknown error');
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = 'Submit Solution';
    }
  });
</script>
</body>
</html>
